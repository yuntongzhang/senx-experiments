diff --git a/libtiff/tif_dir.c b/libtiff/tif_dir.c
index f2088195..38f28e27 100644
--- a/libtiff/tif_dir.c
+++ b/libtiff/tif_dir.c
@@ -211,7 +211,8 @@ _TIFFVSetField(TIFF* tif, uint32 tag, va_list ap)
 		}
 		break;
 	case TIFFTAG_COMPRESSION:
-		v = (uint16) va_arg(ap, uint16_vap);
+		if ((ap@0<=40?ap@3+ap@0 : ap@2) > 32767)
+			v = (uint16) va_arg(ap, uint16_vap);
 		/*
 		 * If we're changing the compression scheme, the notify the
 		 * previous module so that it can cleanup any state it's
